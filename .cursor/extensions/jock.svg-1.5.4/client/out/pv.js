(()=>{"use strict";var e={};class t extends HTMLElement{constructor(){super(),this.inputHasFocus=!1,this._items=[];const e=this.attachShadow({mode:"open"}),t=document.createElement("span"),s=document.createElement("input"),o=document.createElement("div"),n=document.createElement("style");t.className="wrapper",s.addEventListener("focus",(e=>{s.select(),this.inputValueWhenFocus=void 0,this.inputHasFocus=!0,this.active=!0})),s.addEventListener("blur",(()=>{this.inputHasFocus=!1,this.inputValueWhenFocus&&(this.value=this.inputValueWhenFocus),this.active&&setTimeout((()=>{this.active=!1}),50)})),o.className="popup",n.textContent="\n.wrapper {\n    position: relative;\n}\n.wrapper input {\n    width: 3.5em;\n    border: none 0;\n    background-color: var(--vscode-welcomepage-buttonBackground);\n    color: var(--vscode-input-foreground);\n    outline: none 0;\n    text-align: center;\n}\n.wrapper.active input,\n.wrapper input:hover,\n.wrapper input:focus {\n    background-color: var(--vscode-input-background);\n}\n.wrapper input::focus-visible {\n    outline: none 0;\n}\n\n.wrapper .popup {\n    display: none;\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 100%;\n    z-index: 1000;\n    background-color: var(--vscode-dropdown-background);\n    color: var(--vscode-dropdown-foreground);\n    border: solid 1px var(--vscode-dropdown-border);\n    \n}\n.wrapper .popup .item {\n    background-color: var(--vscode-dropdown-listBackground);\n    padding: 1px 3px;\n    cursor: default;\n    text-align: right;\n}\n.wrapper .popup .item:hover {\n    background-color: var(--vscode-list-hoverBackground);\n}\n.wrapper.active .popup {\n    display: block;\n}\n",t.appendChild(s),t.appendChild(o),e.appendChild(t),e.appendChild(n),this.input=s,this.popup=o,this.wrapper=t}dispatchInputEvent(e){this.value=e;const t=new CustomEvent("input");this.dispatchEvent(t)}itemClick(e){if(e.target&&e.target instanceof HTMLDivElement&&e.target.hasAttribute("value")){const t=e.target.getAttribute("value");this.inputHasFocus=!1,this.dispatchInputEvent(t)}this.active=!1}get active(){return this.wrapper.classList.contains("active")}set active(e){e&&!this.wrapper.classList.contains("active")?this.wrapper.classList.add("active"):!e&&this.wrapper.classList.contains("active")&&this.wrapper.classList.remove("active")}get value(){return this.input.value}set value(e){console.debug("set value",e),this.inputHasFocus?this.inputValueWhenFocus=e:this.input.value=e}get items(){return this._items}set items(e){var t;this._items=e;for(let e=0;e<this._items.length;e++){const t=this._items[e];if(this.popup.childElementCount>e){const s=this.popup.children.item(e);s.innerText=t.label,s.setAttribute("value",`${t.value}`)}else{const e=document.createElement("div");e.className="item",e.innerText=t.label,e.setAttribute("value",`${t.value}`),e.addEventListener("mousedown",(e=>this.itemClick(e))),this.popup.appendChild(e)}}for(;this.popup.childElementCount>this._items.length;)null===(t=this.popup.children.item(this._items.length))||void 0===t||t.remove()}set zoomOptions(e){if(e){const t=[];for(const s of e.split(","))/^\d+%$/.test(s)?t.push({value:s,label:s}):console.warn(`zoom option ${s} is not match and ignore`);this.items=t}}attributeChangedCallback(e,t,s){console.debug("attributeChangedCallback",e,t,s)}}window.customElements.define("zoom-combobox",t);const s=12;let o,n,i,a,l,c,r,d,u,p,h,m,v,g,f,b,y,w,L=null,_=!!sessionStorage.getItem("codeInteractive");const E=M("--vscode-tab-activeBackground","#333"),x=M("--vscode-editorLineNumber-activeForeground","#fff"),k=M("--vscode-editorLineNumber-foreground","#ccc");function M(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e)||t}function C(){var e=document.createElement("div");return e.className="btn-group",o.appendChild(e),e}function S(e,t,s,o){var n=document.createElement("button");if(n.type="button",e.appendChild(n),n.onclick=s,t&&(n.innerHTML=t),o)for(let e in o)n.setAttribute(e,o[e]);return n}const T=acquireVsCodeApi();var B=T.getState();B&&"isLocked"in B&&(isLocked=B.isLocked);var F,$=.08;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(F||(F={}));class I{constructor(e){this.orientation=e,this._start=0,this._end=0,this._scale=0,this.canvas=document.createElement("canvas"),e==F.Horizontal?this.canvas.height=s:this.canvas.width=s,this.cxt=this.canvas.getContext("2d"),this.resize(),window.addEventListener("resize",(()=>this.resize()))}get start(){return this._start}get end(){return this._end}get scale(){return this._scale}set start(e){this._start!=e&&(this._start=e,this.draw())}set end(e){this._end!=e&&(this._end=e,this.draw())}set scale(e){this._scale!=e&&(this._scale=e,this.draw())}resize(){this.orientation==F.Horizontal?this.canvas.width=window.innerWidth-s:this.canvas.height=window.innerHeight-o.offsetHeight,this.draw()}draw(){const e=this.cxt,t=this.canvas.width,o=this.canvas.height;e.fillStyle=E,e.fillRect(0,0,t,o);const n=5*scale;if(e.save(),this.orientation==F.Horizontal){e.translate(-this._start,0),e.beginPath();let o=[],i=0;for(let a=0;a<t+this._start;a+=n){let t=a-.5;a<this._start||(a%100==0?(e.moveTo(t,0),e.lineTo(t,s),o.push([a,i])):a%50==0?(e.moveTo(t,4),e.lineTo(t,s),scale>=5&&o.push([a,i])):scale>.25&&(e.moveTo(t,6),e.lineTo(t,s),scale>=10&&o.push([a,i]))),i+=5}e.strokeStyle=k,e.stroke(),e.font="9px sans-serif",o.forEach((t=>{e.fillStyle=E,e.fillText(`${t[1]}`,Math.round(t[0])+3,10),e.fillStyle=x,e.fillText(`${t[1]}`,Math.round(t[0])+2,9)}))}else{e.beginPath(),e.moveTo(11.5,0),e.lineTo(11.5,11.5),e.lineTo(0,11.5),e.strokeStyle=k,e.stroke(),e.translate(0,-this._start),e.beginPath();let t=[],i=0;for(let a=0;a<o+this._start;a+=n){let o=a+s-.5;a<this._start||(a%100==0?(e.moveTo(0,o),e.lineTo(s,o),t.push([a,i])):a%50==0?(e.moveTo(4,o),e.lineTo(s,o),scale>=5&&t.push([a,i])):scale>.25&&(e.moveTo(6,o),e.lineTo(s,o),scale>=10&&t.push([a,i]))),i+=5}e.strokeStyle=k,e.stroke(),e.font="9px sans-serif",t.forEach((t=>{e.save(),e.translate(3,Math.round(t[0])+s+2),e.rotate(Math.PI/2),e.fillStyle=E,e.fillText(`${t[1]}`,1,1),e.fillStyle=x,e.fillText(`${t[1]}`,0,0),e.restore()}))}e.restore()}}function N(){return n.querySelector("#__svg>svg")||n.querySelector("#__svg>img")}function H(e=!0){void 0===scale?scale=1:scale<$?scale=$:scale>64&&(scale=64),e&&z(!1)}function V(e=!0){console.debug("exitFitMode");const t=N();f.style.display="",b.style.display="",t.style.transform="",t.style.transformOrigin="",L&&(t.style.width=`${L.width}px`,t.style.height=`${L.height}px`),fitMode=!1,e&&T.postMessage({action:"fitMode",fitMode})}function z(e=!0){e&&fitMode&&V(),scale<.01?d.value=(1e3*scale).toFixed(2)+"‰":d.value=(100*scale).toFixed(0)+"%",requestAnimationFrame((()=>{if(scale<12)a.style.width="0px",a.style.height="0px";else{a.style.width=`${i.scrollWidth}px`,a.style.height=`${i.scrollHeight}px`;let e=`<svg xmlns="http://www.w3.org/2000/svg" width="${scale}" height="${scale}" viewBox="0 0 ${scale} ${scale}"><path d="M${scale} 0v${scale}h-${scale}" stroke="#808080" stroke-opacity=".5" fill-opacity="0" /></svg>`;a.style.backgroundImage=`url(data:image/svg+xml;base64,${btoa(e)})`}}))}let G=!0;function R(){var e;L||(L=function(){var e,t,s,o,n,i,a,l,c;const r=N();if(r){if(r instanceof HTMLImageElement)return{width:r.naturalWidth,height:r.naturalHeight,canFit:!0,canZoom:!0};if(r instanceof SVGSVGElement){const d={width:null===(e=r.width)||void 0===e?void 0:e.baseVal,height:null===(t=r.height)||void 0===t?void 0:t.baseVal,viewBox:null===(s=r.viewBox)||void 0===s?void 0:s.baseVal,bbox:r.getBBox(),canFit:(null===(n=null===(o=r.width)||void 0===o?void 0:o.baseVal)||void 0===n?void 0:n.unitType)<2&&(null===(a=null===(i=r.height)||void 0===i?void 0:i.baseVal)||void 0===a?void 0:a.unitType)<2,canZoom:(null===(c=null===(l=r.width)||void 0===l?void 0:l.baseVal)||void 0===c?void 0:c.unitType)>0};return d.viewBox&&d.viewBox.width&&d.viewBox.height&&(d.width=d.viewBox.width,d.height=d.viewBox.height,d.canFit=!0,d.canZoom=!0),d}console.warn("Not Found SVG element")}else console.error("Not Found SVG element");return null}()),g.style.display=(null==L?void 0:L.canFit)?"":"none",fitMode?j():(e=(null==L?void 0:L.canZoom)||!1,G=e,f.style.display=G?"":"none",b.style.display=G?"":"none",function(e=!0){const t=N();t&&(t.style.visibility=e?"visible":"hidden")}())}function Z(){_=!_,_?y.classList.add("active"):y.classList.remove("active"),sessionStorage.setItem("codeInteractive",_?"YES":"")}function O(){showCrossLine=!showCrossLine,re(),T.postMessage({action:"cross",value:showCrossLine})}function P(){showRuler=!showRuler,A(),T.postMessage({action:"ruler",value:showRuler})}var U,W;function A(){showRuler?(v.classList.add("active"),document.body.classList.add("with-ruler"),U||(U=new I(F.Horizontal),document.getElementById("__rule_h_host").appendChild(U.canvas)),W||(W=new I(F.Vertical),document.getElementById("__rule_v_host").appendChild(W.canvas))):(v.classList.remove("active"),document.body.classList.remove("with-ruler"))}function q(e){const t=e=>e instanceof SVGGraphicsElement&&"inspectLine"in e.dataset?e:e instanceof Node&&e.parentElement instanceof Element?e.parentElement===e?null:t(e.parentElement):null;return t(e.target)}function Y(e){w&&w.classList.remove("__active_svg_sharp__"),w=e,w&&w.classList.add("__active_svg_sharp__")}function K(){let e=N();e&&e.getBoundingClientRect(),U&&U.draw(),W&&W.draw(),ie&&(ie.style.height=100*scale+"%"),ae&&(ae.style.width=100*scale+"%")}function D(e){document.body.classList.remove("bg-trans","bg-dark-trans","bg-white","bg-black","bg-custom"),document.body.classList.add(e)}function j(){var e,t;if(!L)return;const s=innerWidth-i.offsetLeft,o=innerHeight-i.offsetTop,n=s/o,a="number"==typeof L.width?L.width:null===(e=L.width)||void 0===e?void 0:e.value,l="number"==typeof L.height?L.height:null===(t=L.height)||void 0===t?void 0:t.value,c=a/l>n?(s-40)/a:(o-40)/l,r=N(),d=(s-40-c*a)/2,u=(o-40-c*l)/2;console.log("fit scale",c,d+20,u+20,s,o,a,l),$="number"==typeof a&&a>0&&"number"==typeof l&&l>0?Math.min(c,.08):.08,r.style.transformOrigin="left top",r.style.width=`${a}px`,r.style.height=`${l}px`,r.style.transform=`translate(${d+20}px, ${u+20}px) scale(${c})`}function X(){console.debug("enterFitMode"),1!==scale&&Q(),fitMode=!0,T.postMessage({action:"fitMode",fitMode}),f.style.display="none",b.style.display="none",d.value="FIT",j()}function J(){document.getElementById("__svg").style.transform="",(null==L?void 0:L.canFit)?fitMode||X():console.warn("Can not Fit")}function Q(){L.canZoom&&(scale=1,z(),document.getElementById("__svg").style.transform="scale("+scale+")",T.postMessage({action:"scale",scale}),K())}function ee(){L.canZoom&&(scale*=scaleZoom,H(),document.getElementById("__svg").style.transform="scale("+scale+")",T.postMessage({action:"scale",scale}),K())}function te(){L.canZoom&&(scale/=scaleZoom,H(),document.getElementById("__svg").style.transform="scale("+scale+")",T.postMessage({action:"scale",scale}),K())}function se(e){console.log("zoomInputHandler",d.value);let t=d.value;if(/^\d+$/.test(t)&&(t+="%"),/^\d+%$/.test(t)){let e=.01*Number(t.substring(0,t.length-1));e<$?e=$:e>64&&(e=64),s=e,L.canZoom&&(scale=s,H(),document.getElementById("__svg").style.transform="scale("+scale+")",T.postMessage({action:"scale",scale}),K())}var s}function oe(){o=document.getElementById("__toolbar"),n=document.getElementById("__host"),i=document.getElementById("__svg_container"),a=document.querySelector("#__host .--pixel-grid"),isRootLocked||(l=C(),h=S(l,'<i class="codicon codicon-pin"></i>',(e=>{isLocked?T.postMessage({action:"unlock"}):T.postMessage({action:"lock"})})),h.className="btn",h.title="Locked or Unlocked SVG document",isLocked&&(h.firstElementChild.classList.remove("codicon-pin"),h.firstElementChild.classList.add("codicon-pinned"),h.classList.add("active"))),c=C();var e=S(c,null,(e=>{D("bg-editor"),T.postMessage({action:"bg",color:"editor"})}));e.title="Use Editor Background",e.className="btn-bg bg-editor",(e=S(c,null,(e=>{D("bg-trans"),T.postMessage({action:"bg",color:"transparent"})}))).title="Use Transparent Background",e.className="btn-bg bg-trans",(e=S(c,null,(e=>{D("bg-dark-trans"),T.postMessage({action:"bg",color:"dark-transparent"})}))).title="Use Dark Transparent Background",e.className="btn-bg bg-dark-trans",(e=S(c,null,(e=>{D("bg-white"),T.postMessage({action:"bg",color:"white"})}))).title="Use White Background",e.className="btn-bg bg-white",(e=S(c,null,(e=>{D("bg-black"),T.postMessage({action:"bg",color:"black"})}))).title="Use Black Background",e.className="btn-bg bg-black",(e=S(c,null,(e=>{D("bg-custom"),T.postMessage({action:"bg",color:"custom"})}))).title="Use Custom Background\nModifty 'svg.preview.backgroundCustom' Setting.",e.className="btn-bg bg-custom";var t=C();d=document.createElement("zoom-combobox"),d.zoomOptions=zoomOptions,d.addEventListener("input",se),t.appendChild(d),S(t,'<i class="codicon codicon-screen-normal"></i>',Q,{title:"Zoom To 100%",class:"btn"}),g=S(t,'<i class="codicon codicon-screen-full"></i>',J,{title:"Fit"}),g.className="btn",f=S(t,'<i class="codicon codicon-zoom-in"></i>',ee,{title:"Zoom In",class:"btn"}),b=S(t,'<i class="codicon codicon-zoom-out"></i>',te,{title:"Zoom Out",class:"btn"}),z(!1);var s=C();if(y=S(s,'<i class="codicon codicon-arrow-swap"></i>',Z,{class:"btn"+(_?" active":""),title:"Code interactive"}),m=S(s,'<i class="codicon codicon-add"></i>',O),m.title="Show Crossline",m.className="btn",v=S(s,'<i class="codicon codicon-symbol-ruler"></i>',P),v.title="Show Ruler",v.className="btn",showRuler&&v.classList.add("active"),r=C(),u=S(r,"&lt;svg&gt;",(e=>de("svg"))),u.title="SVG embedded in HTML",u.className="btn","svg"==mode&&u.classList.add("active"),p=S(r,"&lt;img&gt;",(e=>de("img"))),p.title="Show SVG in IMG element\nThis mode displays all legitimate SVG document",p.className="btn","img"==mode&&p.classList.add("active"),"svg"==mode){var E=S(C(),'<i class="codicon codicon-files"></i>'+(customCssFiles>0?`<span class="label">${customCssFiles}</span>`:""),(e=>{T.postMessage({action:"selectcss"})}));E.title="Select CSS Files for preview SVG",E.className="btn"}S(C(),'<i class="codicon codicon-export"></i>',(()=>{!function(){try{let e=document.getElementById("__svg");if("img"==mode)return void pe(e.querySelector("img"));let t=e.innerHTML,s=new Image;s.onload=()=>{pe(s)},s.onerror=e=>{he("Export PNG Fail, SVG may need to be corrected.")};let o="data:image/svg+xml,"+encodeURIComponent(t);s.src=o}catch(e){he("Export PNG Fail, SVG may need to be corrected.")}}()}),{title:"Export PNG"}).className="btn",domains.length&&S(o,'<i class="codicon codicon-warning"></i>',(()=>{}),{class:"btn-label-error",title:`Has ${domains.length} domains maybe cause CORS:\n`+domains.map((e=>e.toLowerCase())).join("\n")}),window.addEventListener("wheel",(e=>{console.log("window wheel",e),(e.ctrlKey||e.metaKey)&&(e.deltaY<0?ee():e.deltaY>0&&te())})),window.addEventListener("keypress",(e=>{console.log("window keypress",e),e.ctrlKey||e.metaKey})),window.addEventListener("message",ue),n.addEventListener("mouseenter",le),n.addEventListener("mousemove",le),n.addEventListener("mouseleave",ce),i.addEventListener("scroll",ne),R(),console.debug("init svgSize",L,scale),L.canFit&&autoFit&&!1!==fitMode?(console.debug("autoFit"),fitMode=!0,T.postMessage({action:"fitMode",fitMode}),X()):(console.debug("normalScale"),H(),V(!1),document.getElementById("__svg").style.transform="scale("+scale+")"),new ResizeObserver((e=>{R()})).observe(i),re(),A(),function(){const e=document.getElementById("__svg");e.addEventListener("mouseenter",(e=>{if(!_)return;const t=q(e);t&&Y(t)}),{capture:!0,passive:!0}),e.addEventListener("mouseleave",(e=>{const t=q(e);t&&t===w&&Y(null)}),{capture:!0,passive:!0}),e.addEventListener("click",(e=>{if(!_)return;const t=q(e);t&&"inspectLine"in t.dataset&&T.postMessage({action:"toLine",line:t.dataset.inspectLine,column:t.dataset.inspectColumn})}),{capture:!0,passive:!0})}()}function ne(){U&&(U.start=i.scrollLeft),W&&(W.start=i.scrollTop),a.style.transform=`translate(${-i.scrollLeft}px, ${-i.scrollTop}px)`}let ie=null,ae=null;function le(e){showCrossLine&&(ie||(ie=document.createElement("div"),ie.style.position="absolute",ie.style.top="0px",ie.style.height="100%",ie.style.width="1px",ie.style.backgroundColor="var(--vscode-foreground)",ie.style.opacity="0.5",ie.style.zIndex="1000",ie.style.cssText+="mix-blend-mode: difference;",n.appendChild(ie)),ae||(ae=document.createElement("div"),ae.style.position="absolute",ae.style.left="0px",ae.style.width="100%",ae.style.height="1px",ae.style.backgroundColor="var(--vscode-foreground)",ae.style.opacity="0.5",ae.style.zIndex="1000",ae.style.cssText+="mix-blend-mode: difference;",n.appendChild(ae)),ie.style.display="block",ae.style.display="block",showRuler?(ie&&(ie.style.height=100*scale+"%"),ae&&(ae.style.width=100*scale+"%"),ie.style.left=e.pageX-s+"px",ae.style.top=e.pageY-s-o.offsetHeight+"px"):(ie.style.left=`${e.pageX}px`,ae.style.top=e.pageY-o.offsetHeight+"px"))}function ce(e){ie&&(ie.style.display="none",ae.style.display="none")}function re(){showCrossLine?(n.style.cursor="none",m.classList.add("active"),ie&&(ie.style.height=100*scale+"%"),ae&&(ae.style.width=100*scale+"%")):(n.style.cursor="default",m.classList.remove("active"),ce())}function de(e){T.postMessage({action:"mode",mode:e}),u.className="svg"==e?"btn active":"btn",p.className="img"==e?"btn active":"btn"}function ue(e){if((s=e.data)&&"string"==typeof s.action){let s=e.data;switch(s.action){case"selection":s.offset;break;case"changeLock":t=s.value,isLocked!=t&&(isLocked=t,T.setState({isLocked}),isLocked?(h.firstElementChild.classList.remove("codicon-pin"),h.firstElementChild.classList.add("codicon-pinned"),h.classList.add("active")):(h.firstElementChild.classList.remove("codicon-pinned"),h.firstElementChild.classList.add("codicon-pin"),h.classList.remove("active")));break;case"hotReload":!function(e){console.log("开始热重载",e);const t=document.getElementById(e);if(t instanceof HTMLLinkElement){const e=new URL(t.href);e.searchParams.set("rand",Math.random().toString()),t.setAttribute("href",e.href)}else console.error(`不支持对${e}的热重载`)}(s.id)}}var t,s}function pe(e){let t=new OffscreenCanvas(e.naturalWidth,e.naturalHeight);t.getContext("2d").drawImage(e,0,0),t.convertToBlob({type:"image/png"}).then((e=>{var t=new FileReader;t.onload=()=>{let e=t.result.replace(/^data:.+;base64,/,"");T.postMessage({action:"export",b64:e,uri})},t.readAsDataURL(e)}))}function he(e){T.postMessage({action:"showerror",msg:e})}for(var me in"loading"!=document.readyState?oe():document.onreadystatechange=function(){"interactive"==document.readyState&&oe()},e)this[me]=e[me];e.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();
//# sourceMappingURL=pv.js.map